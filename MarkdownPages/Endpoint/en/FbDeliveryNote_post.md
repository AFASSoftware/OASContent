You can add new delivery notes, or delivery notes based on sales orders recorded in Profit. If the delivery notes are based on existing sales orders, the details of the original orders can first be retrieved from Profit using a GetConnector. You can fully deliver sales orders or deliver partial orders.

#### Adding delivery notes

When adding new delivery notes, there are hardly any restrictions:

- A delivery note with its related lines must be supplied in a single request body. The body must contain both the header line and the lines.

- You can provide the delivery note number in the field `OrNu`. If not, it must be determined through auto-numbering.

When adding delivery notes based on existing sales orders, the following applies:

- For a delivery note line based on an existing order line, you provide the original order number in the field `SoOr` and the line-GUID of the original line in the field `SoGu`. This does not apply to a new delivery note line.

- By supplying the order number per line, it is possible to collect lines from different orders on one delivery note.

- You may only modify the fields that you can modify when manually adding a delivery note in the UI.

#### Returns

You can book returns via the `FbDeliveryNote` / `FbGoodsReceived` UpdateConnectors. Use the FieldId `QuUn` for this. For example, if you want to make one return entry, this will be `"QuUn" :-1`.

#### Collecting

By supplying the order number per line, it is possible to collect lines from different orders on a single delivery note.

> Note: If you complete delivery notes and the Transsmart (nShift) activation is enabled, and the shipment to Transsmart (nShift) fails, the UpdateConnector will not return a modification.

#### CBS

- CBS Transaction type code `VaTa`

The CBS Transaction type code may be changed in processed receipts and delivery notes, respectively via the UpdateConnectors `FbGoodsReceived` and `FbDeliveryNote`.

#### Compositions with serial number items

You can assign [serial numbers](https://help.afas.nl/help/NL/SE/Item_SerItem.htm "Serial item") to the items of the compositions in a `POST` request.

#### Quantities

For the quantities in the lines, the following applies:

- Stock must be available for the items to be delivered.
- The quantities are always the actual quantities delivered. These quantities are, therefore, always processed in the stock if the stock of the basic item is maintained.
- If the quantity in the delivery note line (in the JSON/XML) corresponds to the quantity to be delivered in the original order line, the original line is considered as completed.
- If the quantity in the delivery note line (in the JSON/XML) is greater than the quantity to be delivered in the original order line, the original line is considered as completed and the possible reservation of the original quantity is processed.
- If the quantity in the delivery note line (in the JSON/XML) is lower than the quantity in the original order line, the line is considered to be a partial delivery. The possible reservation of the original quantity is reduced by the supplied quantity.
- If all lines of the original order are supplied and all original order lines can be considered completed, the original order will be completed during processing. If not all original order lines can be completed, the original order is considered to be partly delivered. The order can then be completed afterward using the available action in Profit.

> Please note: If lines of the original order are not supplied or are supplied with a quantity of zero (0), these lines are considered as still to be delivered. If desired, orders can still be completed using the Complete Order function.

#### Check for basic item

The checks performed by the Connector correspond to the checks performed by Profit with the manual entry of a delivery note. This means that only basic items that are allowed during manual input, may be supplied. Non-allowed basic items will result in an error message, causing the delivery note to be rejected and not created.
It is possible to supply lines with a basic item to which packaging is attached. However, packaging lines cannot be supplied. In this case, the packaging lines in the delivery note will always be generated by Profit. The same applies to composition lines, which are always generated based on the preferred composition recorded for the relevant basic item.
Basic items for which serial numbers, batches, or order specifications apply can also be supplied with the accompanying serial numbers and batch numbers (segment 'FbOrderSerialLines', segment 'FbOrderBatchlines' for both batches and order specifications). For order specifications, the field 'BaNu' must be filled with *****.

#### Delivery notes with warehouse location

You can also include the warehouse location of the items in the 'FbOrderlocationLines' segment in the UpdateConnector for delivery notes.

This is only relevant if you have activated the Warehouse Locations functionality.

You can add warehouse locations with quantities for the following item types:

- Inventory items (excluding batch, serial number, and order specification items), sub-level under the delivery note line.
- Batch items, sub-level under the batch line(s).
- Serial number items, sub-level under the serial number line(s).
- Order specification items, sub-level under the order specification batch line(s).

> You must specify quantities in base units when using warehouse locations in UpdateConnectors.

Providing locations in the UpdateConnector is not mandatory; if no locations are supplied, Profit will distribute the locations itself.

#### Create a delivery note based on a pre-calculation

> Note: this situation is very specific

Scenario:

- You use Projects + Order management
- You use variable compositions
- You want the composition in your cost estimate to be different from the one on your delivery note

All composition rules are taken over. The one-time composition item lines that appear on the cost estimate can be adjusted immediately with the insert. However, if a cost estimate contains composition rules in which the same item code occurs more than once, the delivery note must be created first. Then the delivery note can be adjusted based on the fields: `VaIt`, `ItCd`, and `GuLi`.
